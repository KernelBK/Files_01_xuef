<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>'()</title>
<%
	pageContext.setAttribute("emp_path", request.getContextPath());
%>

<!-- jQuery -->
<script src="${emp_path}/js/jquery-1.10.1.js"></script>
<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet"
	href="${emp_path}/css/bootstrap-3.3.7-dist/css/bootstrap.min.css" />
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="${emp_path}/css/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

</head>
<body>
	<div class="container">
		<!-- 标题 -->
		<div class="row">
		  	<div class="col-md-12"><h1>EmpsAdmS</h1></div>
		</div>
		
		<!-- 标题一般操作 -->
		<div class="row">
		  	<div class="col-md-4 col-md-offset-9">
		  		<button type="button" class="btn btn-primary"> 
		  			 Add <span class="glyphicon glyphicon-plus"></span></button>
		  		<button type="button" class="btn btn-danger"> 
		  			 DelALL<span class="glyphicon glyphicon-remove"></span></button>
			</div>
		</div>
		<div class="row">
		  	<div class="col-md-12"><h4>******</h4></div>
		</div>
		<!-- 数据展示 -->
		<div class="row">
			<div class="col-md-12">
				<table class="table table-bordered table-hover" id="emps_table">
					<thead>
						<tr class="info">
							<th>工号</th>
							<th>姓名</th>
							<th>性别</th>
							<th>岗位</th>
							<th>部门</th>
							<th>地点</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody>
					
					</tbody>
				</table>
			</div>
		</div>
		
		<!-- 分页信息 -->
		<div class="row">
			<div class="col-md-6" id="page_info">
				
			</div>
			<div class="col-md-6" id="page_nav">
			</div>
		</div>
	</div>
	<!-- 页面加载完成后 -->
	<script type="text/javascript">
		$(function(){
			to_page(1)
		})
		function to_page(pageNo){
			$.ajax({
				url: "${emp_path}/emps",
				type: "get",
				data: "pageNo="+pageNo,
				success: function(res){
					console.log(res)
					build_emps(res)
					build_page_info(res)
					build_page_nav(res)
				}
			})
		}
		// 构建员工列表
		function build_emps(res){
			$("#emps_table tbody").empty()
			var emps = res.res.pageInfo.list
			$.each(emps, function(index, item){
				//<input type="text" class="form-control" id="exampleInputName2" placeholder="Jane Doe">
				var eNoInput = $("<input/>").attr("type", "text")
											.addClass("form-control")
											.attr("size", "1")
											.attr("id", "disabledTextInput")
				var eNameInput = $("<input/>").attr("type", "text")
											  .addClass("form-control")
											  .attr("size", "3")
				var eGenderInput = $("<input/>").attr("type", "text")
												.addClass("form-control")
												.attr("size", "1")
				var eJobInput = $("<input/>").attr("type", "text")
											.addClass("form-control")
											.attr("size", "5")
				var dNameInput = $("<input/>").attr("type", "text")
											.addClass("form-control")
											.attr("size", "5")
				var dLocInput = $("<input/>").attr("type", "text")
											.addClass("form-control")
											.attr("size", "4")
				
				var eNoTd = $("<td></td>").append(eNoInput.attr("placeholder", item.eNo))
				var eNameTd = $("<td></td>").append(eNameInput.attr("placeholder", item.eName))
				var eGenderTd = $("<td></td>").append(eGenderInput.attr("placeholder", 
																	item.eGender == "m" ? "男":"女"))
				var eJobTd = $("<td></td>").append(eJobInput.attr("placeholder", item.eJob))
				var deptNameTd = $("<td></td>").append(dNameInput.attr("placeholder", item.department.dName))
				var deptLocTd = $("<td></td>").append(dLocInput.attr("placeholder", item.department.dLocation))
				//var eNoTd = $("<td></td>").append(item.eNo)
				//var eNameTd = $("<td></td>").append(item.eName)
				//var eGenderTd = $("<td></td>").append(item.eGender == "m" ? "男":"女")
				//var eJobTd = $("<td></td>").append(item.eJob)
				//var deptNameTd = $("<td></td>").append(item.department.dName)
				//var deptLocTd = $("<td></td>").append(item.department.dLocation)
				var opeTd = $("<td></td>")
						.append($("<button></button>")
									.attr("type","button")
									.addClass("btn btn-primary btn-sm")
									.text("Edit")
									.append($("<span></span>")
									.addClass("glyphicon glyphicon-pencil")))
						.append(" ")
						.append($("<button></button>")
									.attr("type","button")
									.addClass("btn btn-danger btn-sm")
									.text("DeL")
									.append($("<span></span>")
									.addClass("glyphicon glyphicon-remove")))
				$("<tr></tr>").append(eNoTd).append(eNameTd).append(eGenderTd)
							  .append(eJobTd).append(deptNameTd).append(deptLocTd)
							  .append(opeTd)
							  .appendTo("#emps_table tbody")
			})
		}
		// 分页信息
		function build_page_info(res){
			$("#page_info").empty()
			var page_info_json = res.res.pageInfo
			$("#page_info").append("当前第 "+ page_info_json.pageNum + 
					" 页 共 " + page_info_json.pages + " 页 " + page_info_json.total + " 条记录")
		}
		// 分页导航
		function build_page_nav(res){
			$("#page_nav").empty()
			var page_info_json = res.res.pageInfo
			var nav = $("<nav></nav>")
			var par_ul = $("<ul></ul>").addClass("pagination")
			var first = $("<li></li>").append($("<a></a>").append("首页"));
			
			var pre = $("<li></li>").append($("<a></a>")
											.append("&laquo;"));
			
			// 没有前一页时，禁用首页和pre链接
			if(page_info_json.hasPreviousPage == false){
				first.addClass("disabled")
				pre.addClass("disabled")
			}else{
				first.click(function(){
					to_page(1);
				});
				pre.click(function(){
					to_page(page_info_json.pageNum-1)
				});
			}
			var next = $("<li></li>").append($("<a></a>").append("&raquo;"));
			var last = $("<li></li>").append($("<a></a>").append("末页"));
			// 没有后一页时，禁用末页和next链接
			if(page_info_json.hasNextPage == false){
				next.addClass("disabled")
				last.addClass("disabled")
			}else{
				next.click(function(){
					to_page(page_info_json.pageNum+1)
				});
				
				last.click(function(){
					to_page(page_info_json.pages)
				});
			}
				
			par_ul.append(first).append(pre)
			
			$.each(page_info_json.navigatepageNums, function(index, item){
				var cur = $("<li></li>").append($("<a></a>").append(item)
													.click(function(){
														to_page(item)
													}));
				// 高亮当前页
				if(page_info_json.pageNum == item){
					cur.addClass("active");
				}
				par_ul.append(cur)
				par_ul.append(next).append(last)
			})
			nav.append(par_ul)
			$("#page_nav").append(nav)
		}
	</script>
</body>
</html>